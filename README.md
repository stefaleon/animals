# animals
* React Native with Redux mini app
* Remake of the tech-stack app, displaying a list of animals instead of tech-libraries
* Part of [The Complete React Native and Redux Course](https://www.udemy.com/the-complete-react-native-and-redux-course/)
by [Stephen Grider](https://github.com/stephengrider)

&nbsp;
### Node, NPM, Yarn, react-native, redux, react-redux


&nbsp;
## 00 Initial commit

* Initialize a new project with the react-native cli.

```
$ react-native init animals
```




&nbsp;
## 01 Basic boilerplate

* Install Redux and react-redux

```
$  npm install --save redux react-redux

```

* Create the src folder, move App.js in it and edit index.js in order to find the new location of App.js.

*./index.js*

```
import { AppRegistry } from 'react-native';
import App from './src/App';

AppRegistry.registerComponent('manager', () => App);
```
* Create the reducers folder inside src. Create index.js inside reducers and inside combineReducers add the animalsReducer that returns an empty list.

*./src/reducers/index.js*

```
import { combineReducers } from 'redux';

export default combineReducers({
  animalsReducer: () => []
});
```

* Remove the default content out of App.js and replace it with the following basic boilerplate code for a react native with redux app.

*./src/App.js*
```
import React, { Component } from 'react';
import { Text,  View } from 'react-native';
import { Provider } from 'react-redux';
import { createStore } from 'redux';
import reducers from './reducers';

export default class App extends Component<{}> {
  render() {
    return (
      <Provider store={createStore(reducers)} >
        <View>
          <Text>
              Animals - React Native with Redux
          </Text>
        </View>
      </Provider>
    );
  }
}
```


* An error such as

```
You have not accepted the license agreements of the following SDK components:
[Android SDK Build-Tools 23.0.1].
```

might occure due to the absence of the *./android/local.properties* file.
This file should have been autogenerated by android.
If it is not present, add it and fill in the location of the SDK folder, something like

```
sdk.dir=C\:\\Users\\YOUR_USER_ACCOUNT\\AppData\\Local\\Android\\Sdk
```



&nbsp;
## 02 Header and AnimalReducer

* Get a copy of the *./Components/common* folder from the [*auth*](https://github.com/stefaleon/Authentication-with-React-Native) app.

* Import *Header* and use it in App.js.

```
import { Header } from './components/common';
```

```  
    <Header headerText="Animals" />
```

* Add some animal data. In *./src/reducers* create *animals.json* which will contain the animals' data as a JSON object. Source: [San Diego Zoo](http://animals.sandiegozoo.org/animals)

* In *./src/reducers* create *AnimalReducer.js*. It will be returning the list of animals. Import and export the data from './animals.json'.

```
import data from './animals.json';

export default () => data;
```


* Wire AnimalReducer up in *./src/reducers/index.js*. The animals property of the combineReducers, gets the state from AnimalReducer.

```
import { combineReducers } from 'redux';
import AnimalReducer from './AnimalReducer';

export default combineReducers({
  animals: AnimalReducer
});
```


&nbsp;
## 03 Map state to props and list titles

* Connect to the store. Create the *AnimalsList.js* file inside the */src/components* folder. Connect to the Redux store and retrieve the *animals* piece of state.  

  * The react-redux *connect()* function takes *mapStateToProps* as an argument.

  * The return of *connect(mapStateToProps)* is also a function which takes *AnimalsList* as its parameter. The result  is being exported by *AnimalsList.js*

  * The *mapStateToProps* function takes the *state* as its parameter and returns an object containing the *state.animals*. These are passed to *AnimalsList* as props.

  * On the componentWillMount lifecycle method these props are passed to a ListView, via boilerplate code. Rows' changes are monitored and the ListView.DataSource is provided with appropriate data.

  * Define the howToRenderRow method in order to instruct the ListView rergarding row rendering. Temporarily returns an empty list.


*/src/components/AnimalsList.js*
```
import React, { Component } from 'react';
import { ListView } from 'react-native';
import { connect } from 'react-redux';

class AnimalsList extends Component {
  componentWillMount() {
    const ds = new ListView.DataSource({
      rowHasChanged: (r1, r2) => r1 !== r2
    });

    this.dataSource = ds.cloneWithRows(this.props.animals);
  }

  howToRenderRow() {
    return [];
  }

  render() {
    return(
      <ListView
        dataSource = {this.dataSource}
        renderRow = {this.howToRenderRow}
       />
    );
  }
}

const mapStateToProps = state => {
  return { animals: state.animals };
};

export default connect(mapStateToProps)(AnimalsList);
```

* In *App.js*

```
import AnimalsList from './components/AnimalsList';
```
```
export default class App extends Component<{}> {
  render() {
    return (
      <Provider store={createStore(reducers)} >
        <View>
          <Header headerText="Animals" />
          <AnimalsList />
          <Text>
            The animals are now coming from the Redux store to the React View.
          </Text>
        </View>
      </Provider>
    );
  }
}
```


### Display the titles

* Create the *ListItem.js* file inside the */src/components* folder. Add appropriate JSX code in order to display the title property of the JSON data object. Reuse the CardSection component from the common components. The *animal* property will be defined in the next paragraph.

*/src/components/ListItem.js*
```
import React, { Component } from 'react';
import { Text } from 'react-native';
import { CardSection } from './common';

export default class ListItem extends Component {
  render() {
    return (
      <CardSection>
        <Text>{this.props.animal.title}</Text>        
      </CardSection>
    );
  }
}
```


* In *AnimalsList.js* add the *animal* parameter in *howToRenderRow()* and also pass it as a prop to the *ListItem*.

```
import ListItem from './ListItem';
```

```
howToRenderRow(animal) {
  return <ListItem animal={animal}/>
}
```


* Style the Text in ListItem.

```
<Text style={styles.titleStyle}>
```
```
const styles = {
  titleStyle: {
    fontSize: 20,
    paddingLeft: 15
  }
};
```

* Flex the View in App.

```
<View style={{ flex:1 }}>
```





&nbsp;
## 04 SelectionReducer, selectAnimal and expand row

* In *./src/reducers* create *SelectionReducer.js*. Avoid undefined state in the beginning by setting initial state to null (implying that we have no specific library selected to begin with).

*./src/reducers/SelectionReducer.js*
```
export default () => {
  return null;  
};
```

* Wire it up in *./src/reducers/index.js*. Import and attach it to the *selectedAnimalId* property inside combineReducers.

```
import SelectionReducer from './SelectionReducer';
```
```
export default combineReducers({
  animals: AnimalReducer,
  selectedAnimalId: SelectionReducer
});
```

* Create the *actions* folder and the *src/actions/index.js* file. It exports the action creator function *selectAnimal*, which returns the action with the *select_animal* type. The *animalId* argument passed to this action creator function, is being attached to the payload property of the returned action object.

*src/actions/index.js*
```
export const selectAnimal = (animalId) => {
  return {
    type: 'select_animal',
    payload: animalId
  };
};
```

* In ListItem.js import all actions as *actions*.

```
import * as actions from '../actions';
```

* Import the connect helper.

```
import { connect } from 'react-redux';
```

* Setup the connection. There is not mapStateToProps set up yet, so the first patrameter of connect() is null. The second parameter is the *actions* object.

```
export default connect(null, actions)(ListItem);
```


* Now the action creator function *selectAnimal* is connected to the *ListItem* component and is available as props to be called when a touch event occurs. A touchable component is required in order to receive the touch event. Import TouchableWithoutFeedback, which is appropriate for this case. Also import the View object.

```
import { Text , TouchableWithoutFeedback, View } from 'react-native';
```

* Wrap the return in a TouchableWithoutFeedback block, and also internally to a View so that another CardSection can be added later. Call the *selectAnimal* action creator on the onPress event and pass it the particular current animal's Id.

```
class ListItem extends Component {
  render() {
    return (
      <TouchableWithoutFeedback
        onPress={ () => this.props.selectAnimal(this.props.animal.id) }
      >
        <View>
          <CardSection>
            <Text style={styles.titleStyle}>
              {this.props.animal.title}
            </Text>
          </CardSection>
        </View>
      </TouchableWithoutFeedback>
    );
  }
}
```

* Return the selected animal's Id. Edit SelectionReducer.js so that it returns the action's payload when the dispatched action comes from selectAnimal.

*./src/reducers/SelectionReducer.js*
```
export default (state  =  null, action) => {
  switch (action.type) {
    case 'select_animal':
      return action.payload;
    default:
      return state;
  }
};
```

### Expand the selected row

* In ListItem.js, compare the state's selectedAnimalId item to the own props animal id, inside the mapStateToProps function which takes the state as its first argument and ownProps as the second argument. The *expanded* flag is returned to the component.

```
const mapStateToProps = (state, ownProps) => {
  const expanded = state.selectedAnimalId === ownProps.animal.id;
  return { expanded };
};
```

* Pass mapStateToProps as the first argument to the connect handler.

```
export default connect(mapStateToProps, actions)(ListItem);
```


* Define the renderDescription helper function. The animal description will be displayed if the passed to component's props expanded flag is true.

```
renderDescription() {
  if ( this.props.expanded ) {
    return (
      <Text>{this.props.animal.description}</Text>
    );
  }
}
```


* Display the result of renderDescription() inside the ListItem's render result.

```
{this.renderDescription()}
```
